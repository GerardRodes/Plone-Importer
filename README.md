# Plone-Importer
Import XML to Dexterity objects

Optimized to work with the XML generated by [Plone Exporter](https://github.com/GerardRodes/Plone-Exporter), It reads attributes defined at the XML like: `uid`, `type`, `content_type`, ... so it's recommended to use the [Plone Exporter](https://github.com/GerardRodes/Plone-Exporter).
It will output a log file of all the process at `'/tmp/importer/{meta_type}'`.

## How to  
Define an external method like this
```python
from Products.CMFCore.utils import getToolByName
import Importer

def my_external_method(self):
  portal_url = getToolByName(self, 'portal_url')
  portal     = portal_url.getPortalObject()
  Importer(
    portal = portal,
    xml_path = '/tmp/import/Events.xml',
    folder_path = '/fs-mysite/mysite/activity-schedule',
    meta_type = 'Event')
```

### Parameters  
+ **xml_path**: path to the XML file to import.  
+ **portal**: portal object.  
+ **folder_path**: folder path (of the plone site) to import the objects, if doesn't exists is created automatically.  
+ **meta_type**: `meta_type` of the content on the site, by default it will use as `meta_type` the name of the XML file.  
+ **tagname**: tagname of the tags inside the XML containing the information about the object, by default its value is `item`.  
+ **fields_map**: if needed an array containing information of how the tags of the XML relate with the attributes of the dexterity object, it can contain filters to mutate the original value.    
+ **publish**: if `True` the imported content will be automatically published, by deufalt it's `True`.  


### Mapping fields  
By default the importer will try to set the value to a field with the same name than the tag containing the value, but sometimes the name of the tags and the name of the attribute aren't the same, or you want to apply some tansformations to the original value before it's setted to the object, if we want to specify information like that we have to do it like this:
```python
from Products.CMFCore.utils import getToolByName
import Importer

def my_external_method(self):
  portal_url = getToolByName(self, 'portal_url')
  portal     = portal_url.getPortalObject()
  Importer(
    portal = portal,
    xml_path = '/tmp/import/Events.xml',
    folder_path = '/fs-mysite/mysite/activity-schedule',
    meta_type = 'Event',
    fields_map = [
      {
        'xml': 'name_of_the_tag',
        'dexterity': 'name_of_the_attribute',
        'filter': lambda value: value.lower(),
      },
      {
        'xml': 'name_of_the_tag2',
        'dexterity': 'name_of_the_attribute2',
      }
    ])
```

### Field types
Every field at the XML can have an attribute `type` which specifies which is the type of the value to be stored (if none is defined it will use `string` by default), right now the Importer can handle this types:
+ string 
+ datetime 
+ reference 
+ lines 
+ file 
+ text 
+ boolean   

__all fields processors are defined inside the `build_objects` function__
